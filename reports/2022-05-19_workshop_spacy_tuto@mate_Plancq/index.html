<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../../sunset.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link href="../../_app/immutable/assets/0.D0TAEvq0.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.B9fD-3Wj.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/ATQqNzrN.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CXCHmQ-B.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.DF3f1qoj.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C1FmrZbK.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DuaWf0Pd.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.HaHf7Tap.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DKuRuggZ.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/7.BTHH_Nau.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BheWnx7M.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/D2-NGLRx.js"><!-- HEAD_svelte-1i32evn_START --><!-- HEAD_svelte-1i32evn_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">     <div class="content">  <nav class="svelte-epptjw"> <a href="/" class="svelte-epptjw" data-svelte-h="svelte-4ebbsj"><h1 class="svelte-epptjw">/log</h1></a> <ul class="svelte-epptjw"><li><a href="/reports" class="svelte-epptjw active" data-svelte-h="svelte-12wekpw">Comptes rendus</a></li> <li><a href="/notes" class="svelte-epptjw" data-svelte-h="svelte-eu7epz">Notes</a></li> <li><a href="/projets" class="svelte-epptjw" data-svelte-h="svelte-4lv15p">Projets</a></li>  <li><button class="switch svelte-epptjw" role="switch" aria-checked="true"></button></li></ul></nav>   <main>  <article><p class="date">19 mai 2022</p> <p class="speaker">ClÃ©ment Plancq</p> <h1 data-svelte-h="svelte-1nkrmnk">Tuto@mate - de lâ€™utilisation de spaCy, comment parser un texte avec une bibliothÃ¨que Python</h1> <h2 data-svelte-h="svelte-g1gtei">Ressources</h2> <ul data-svelte-h="svelte-1sfcbuq"><li><a href="https://github.com/clement-plancq/tuto-mate" rel="nofollow">Notebook du tuto@mate</a> pour tester le code sans installer Python et spaCy (cliquer sur launch binder dans le README.md)</li> <li><a href="https://course.spacy.io/fr/" rel="nofollow">Cours par Ines Montani</a></li></ul> <h2 data-svelte-h="svelte-1ukekoe">Introduction</h2> <p data-svelte-h="svelte-fogvb4">SpaCy est un librairie Python pour le TAL, developpÃ©e par Matthew Honnibal et Ines Montani. Câ€™est une bibliothÃ¨que Python pour le traitement des TAL sous licence libre (MIT 2.0), bien que distribuer par une sociÃ©tÃ© privÃ©e. En revanche les modÃ¨les sont distribuÃ©s sous divers licences ouvertes (liÃ©es aux documents qui ont permis leur Ã©laboration).</p> <p data-svelte-h="svelte-1ixut60">SpaCy est destinÃ© Ã  Ãªter utilisÃ© en productionÂ : donc traitement rapide, stable, qualitÃ© du code (test, documentation, etc.). Mais pas de chois dans le mÃ©thode ou lâ€™algorithme utilisÃ©. On sait ce qui est utilisÃ©, câ€™est documentÃ©, mais on ne peut pas modifier ces paramÃ¨tres.</p> <p data-svelte-h="svelte-9ncpi3">Peut faireÂ :</p> <ul data-svelte-h="svelte-89vpcj"><li>tokenisation</li> <li>Ã©tiquetage POS (verbe, nom, etc.)</li> <li>analyse syntaxique</li> <li>detection dâ€™entitÃ©s nommÃ©es</li> <li>lemmatisation</li> <li>catÃ©gorisation de texte</li> <li>word embedding</li></ul> <p data-svelte-h="svelte-1yb6fsm">SpaCy utilise des modÃ¨les statistique (mÃ©thode neuronales).</p> <p data-svelte-h="svelte-1l7621r">IntÃ©rÃªtsÂ : câ€™est dy Python (wrapper R Ã©galement), simple Ã  prendre en main, trÃ¨s bien documentÃ© (doc, tuto, etc.), grosse communautÃ© sur github, fournit les mÃ©thodes et les moyens dâ€™adapter le traitement et ou le modÃ¨le Ã  des besoins particuliers ! Mais ce nâ€™est pas forcÃ©ment lâ€™outils qui sera le meilleurs pour le franÃ§ais dans toutes les tÃ¢ches de TAL.</p> <p data-svelte-h="svelte-dtqr8k">Il existe dâ€™autre frameworks pour le TAL</p> <ul data-svelte-h="svelte-g9uolk"><li>NLKTÂ : python, orientÃ© pÃ©dagogie, chois des mÃ©thodes et algos Ã  utiliser</li> <li>CoreNLPÂ : java, framework de Stanford, orientÃ© recherche, chaÃ®ne de TAL la plus complÃ¨te pour lâ€™anglais</li> <li>StanzaÂ : python, framework de Stanford Ã©galement, modÃ¨le neuronaux entraÃ®nÃ©s sur les donnÃ©es dâ€™Universal Dependancies (il y a un module spacy-stanza pour utiliser les modÃ¨les de Stanza</li> <li>FlairÂ : python, framewok de Zalando (site de e-commerce), peut Ãªtre le plus performant sur la reconnaissance dâ€™entitÃ©s nommÃ©es</li></ul> <p data-svelte-h="svelte-169phrd">Les modÃ¨les de spaCy
SpaCy utilise des modÃ¨les statistiques qui permettent de prÃ©dire des annotations linguistiques (identifier un verbe, un nom, le sentiment dâ€™une phrase).
21 langues prise en compte. La qualitÃ© des rÃ©sultats dÃ©pend beaucoup du corpus sur lequel sâ€™est entraÃ®nÃ© le modÃ¨le.
Pour le franÃ§ais, il y a 3 modÃ¨les + 1. Il sont tous issus du corpus <a href="http://www.linguist.univ-paris-diderot.fr/~mcandito/Publications/candito-seddah-taln2012.pdf" rel="nofollow">Sequoia</a> (wikipedia + presse (Est-rÃ©publicain) + Agence euro du mÃ©dicament, Europarl) et WikiNer, sauf le modÃ¨le trf, qui est issu de camembert-base (modÃ¨le Bert), distribuÃ© par Hugginf Face, entraÃ®nÃ© sur Oscar.</p> <p data-svelte-h="svelte-xt0p3n">Le choix du modÃ¨le est vraiment primordial pour les traitements.</p> <h2 data-svelte-h="svelte-1l3kxey">Ã‰tape de la chaÃ®ne de traitement</h2> <h3 data-svelte-h="svelte-ayx0qe">Tokenisation</h3> <p data-svelte-h="svelte-188d52t">OpÃ©ration qui consiste Ã  dÃ©couper un texte ou chaÃ®ne de caractÃ¨res en token. En linguistique il nâ€™y a pas de dÃ©finition prÃ©cise de Â« mot Â», on parle alors de token. Les signes de ponctuation sont tokÃ©nisÃ©s.</p> <p data-svelte-h="svelte-twcz49">Lâ€™intÃ©rÃªt de spaCy, câ€™est que sa tokÃ©nisation nâ€™est pas destructive. On peut donc, Ã  partir de la tokenisation, reformer le texte (conservation des espaces par exemple).</p> <p data-svelte-h="svelte-1r7hqkf">Il est possible de modifier la tokenisation par dÃ©faut.</p> <p data-svelte-h="svelte-zt8fsk">Concernant la tokÃ©nisation, SpaCy permet aussi de rÃ©cupÃ©rer des groupes nominaux. Il est Ã©galement possible de rÃ©cupÃ©rer les phrases dâ€™un texte.</p> <h3 data-svelte-h="svelte-9tk5gg">Ã‰tiquetage (tagging)</h3> <p data-svelte-h="svelte-1n1zpla">Ã‰tape qui permet, pour chaque token de dÃ©terminer sâ€™il sâ€™agit dâ€™un verbe, du adjectif, dâ€™un nom, etc.</p> <pre class="language-python"><!-- HTML_TAG_START --><code class="language-python">doc <span class="token operator">=</span> nlp<span class="token punctuation">(</span><span class="token string">"Tous mes beaux chÃ¢teaux d'Ã‰quateur s'Ã©croulent."</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> tok <span class="token keyword">in</span> doc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>tok<span class="token punctuation">,</span> tok<span class="token punctuation">.</span>pos_<span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <blockquote data-svelte-h="svelte-kzzplv"><p>Tous ADJ
mes DET
beaux ADJ
chÃ¢teaux NOUN
dâ€™ ADP
Ã‰quateur PROPN
sâ€™ PRON
Ã©croulent VERB
. PUNCT</p></blockquote> <p data-svelte-h="svelte-yv1kd0">Les annotation portant sur les token sont accessibles via les attributs des objets de type token</p> <ul data-svelte-h="svelte-vocjgu"><li>pos_ contient lâ€™Ã©tiquette de partie du discours de universal dependancies</li> <li>tag_ contient lâ€™Ã©tiquette du corpus original, parfois plus dÃ©taillÃ©e</li> <li>lemma_ pour le lemme</li> <li>morph pour lâ€™analyse morphologique</li></ul> <pre class="language-python"><!-- HTML_TAG_START --><code class="language-python"><span class="token keyword">for</span> token <span class="token keyword">in</span> doc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> token<span class="token punctuation">.</span>lemma_<span class="token punctuation">,</span> token<span class="token punctuation">.</span>pos_<span class="token punctuation">,</span> token<span class="token punctuation">.</span>morph<span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <blockquote data-svelte-h="svelte-12j9sc5"><p>Tous tout ADJ Gender=Masc|Number=Plur
mes mon DET Number=Plur|Poss=Yes
beaux beal ADJ Gender=Masc|Number=Plur
chÃ¢teaux chÃ¢teau NOUN Gender=Masc|Number=Plur
dâ€™ de ADP
Ã‰quateur Ã‰quateur PROPN
sâ€™ se PRON Person=3|Reflex=Yes
Ã©croulent Ã©crouler VERB Mood=Ind|Number=Plur|Person=3|Tense=Pres|VerbForm=Fin
. . PUNCT</p></blockquote> <h3 data-svelte-h="svelte-11hjjw4">DÃ©tection dâ€™entitÃ©s nommÃ©es (ner)</h3> <p data-svelte-h="svelte-37r4y2">Pour repÃ©rer les noms de personnes, de lieux, dâ€™organisation, miscelannÃ©e et parfois mÃªme les dates.</p> <p data-svelte-h="svelte-8tedxk">Il y a Ã©galement dans spaCy un visualiseur, qui permet dâ€™avoir une reprÃ©sentation visuel du traitement du texte en html.</p> <p data-svelte-h="svelte-1cbgjnp">Il est possible dâ€™adapter la reconnaissance des entitÃ©s nommÃ©es, voire mÃªme dâ€™entrainer dâ€™autres modÃ¨les.</p> <h3 data-svelte-h="svelte-19wnw9b">Analyse syntaxique (parsing)</h3> <p data-svelte-h="svelte-1ect0ua">Câ€™est une analyse en dÃ©pendance avec spaCy. Dans ce type dâ€™analyse, chaque mot dâ€™une phrase Ã  un gouverneur unique (head), la relation de dÃ©pendance entre le mot et son gouverneur est typÃ©e (nsubj, obj, etc.) Pour la tÃªte de la phrase on utilise la relation ROOT.</p> <p data-svelte-h="svelte-1fcas5u">La structure produite par lâ€™analyse syntaxique est un arbre, un graphe acyclique et connexe.
Les tokens sont les nÅ“uds, les arcs sont les dÃ©pendances, le type de la relation est lâ€™Ã©tiquette de lâ€™arc.</p> <pre class="language-python"><!-- HTML_TAG_START --><code class="language-python">doc <span class="token operator">=</span> nlp<span class="token punctuation">(</span><span class="token string">"Il te refile en stÃ©rÃ©o la chanson des sirÃ¨nes."</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> token <span class="token keyword">in</span> doc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> token<span class="token punctuation">.</span>dep_<span class="token punctuation">,</span> token<span class="token punctuation">.</span>head<span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <blockquote data-svelte-h="svelte-jsh8p4"><p>Il expl:subj refile
te iobj refile
refile ROOT refile
en case stÃ©rÃ©o
stÃ©rÃ©o obl:arg refile
la det chanson
chanson obj refile
des case sirÃ¨nes
sirÃ¨nes nmod chanson
. punct refile</p></blockquote> <p data-svelte-h="svelte-1crldaq">Il existe aussi une reprÃ©sentation graphique de la dÃ©pendance des tokens entre eux.</p> <p data-svelte-h="svelte-sd9oro">Dans lâ€™analyse en dÃ©pendance on peut aussi parcourir lâ€™arbre de dÃ©pendance. Les attributs de token suivant peuvent Ãªtre utilisÃ©s pour parcourir lâ€™arbre de dÃ©pendanceÂ :</p> <ul data-svelte-h="svelte-1cogdop"><li><code>children</code> les tokens dÃ©pendants du token</li> <li><code>subtree</code> tous les descendants du token</li> <li><code>ancestors</code> tous les parents du token</li> <li><code>rights</code> les enfants Ã  droite du token</li> <li><code>lefts</code> les enfants Ã  gauche du token</li></ul> <pre class="language-python"><!-- HTML_TAG_START --><code class="language-python">root <span class="token operator">=</span> <span class="token punctuation">[</span>token <span class="token keyword">for</span> token <span class="token keyword">in</span> doc <span class="token keyword">if</span> token<span class="token punctuation">.</span>head <span class="token operator">==</span> token<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
subjects <span class="token operator">=</span> <span class="token punctuation">[</span>tok <span class="token keyword">for</span> tok <span class="token keyword">in</span> root<span class="token punctuation">.</span>lefts <span class="token keyword">if</span> <span class="token string">"subj"</span> <span class="token keyword">in</span> tok<span class="token punctuation">.</span>dep_<span class="token punctuation">]</span>
subject <span class="token operator">=</span> subjects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
objs <span class="token operator">=</span> <span class="token punctuation">[</span>tok <span class="token keyword">for</span> tok <span class="token keyword">in</span> root<span class="token punctuation">.</span>rights <span class="token keyword">if</span> tok<span class="token punctuation">.</span>dep_ <span class="token operator">==</span> <span class="token string">"obj"</span><span class="token punctuation">]</span>
obj <span class="token operator">=</span> objs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"sujet : </span><span class="token interpolation"><span class="token punctuation">&#123;</span>subject<span class="token punctuation">&#125;</span></span><span class="token string">, prÃ©dicat : </span><span class="token interpolation"><span class="token punctuation">&#123;</span>root<span class="token punctuation">&#125;</span></span><span class="token string">, objet : </span><span class="token interpolation"><span class="token punctuation">&#123;</span>obj<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <blockquote data-svelte-h="svelte-14w7u1i"><p>sujetÂ : Il, prÃ©dicatÂ : refile, objetÂ : chanson</p></blockquote> <h2 data-svelte-h="svelte-1l8s3lo">Extraction dâ€™information</h2> <p data-svelte-h="svelte-didik0">Ã€ partir de tous ces traitements, il est possible dâ€™effectuer dâ€™autres opÃ©rations.
Spacy a une classe Matcher qui permet de repÃ©rer des tokens ou des sÃ©quences de tokens Ã  lâ€™aide de patrons (pattern).
Ces patrons peuvent porter sur la forme des tokens ou leurs attributs (pos, ent, â€¦).
On peut aussi utiliser des catÃ©gories comme IS_ALPHA ou IS_NUM, voir la doc
(Il existe une dÃ©mo avec interface graphique mais pas pour le franÃ§ais ğŸ™)</p> <pre class="language-python"><!-- HTML_TAG_START --><code class="language-python"><span class="token keyword">from</span> spacy<span class="token punctuation">.</span>matcher <span class="token keyword">import</span> Matcher
doc <span class="token operator">=</span> nlp<span class="token punctuation">(</span><span class="token string">"Ce modÃ¨le est aussi disponible en taille XL ; je vous le conseille."</span><span class="token punctuation">)</span>
matcher <span class="token operator">=</span> Matcher<span class="token punctuation">(</span>nlp<span class="token punctuation">.</span>vocab<span class="token punctuation">)</span>

pattern <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"LOWER"</span><span class="token punctuation">:</span> <span class="token string">"en"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"LOWER"</span><span class="token punctuation">:</span> <span class="token string">"taille"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"IS_ALPHA"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">"IS_UPPER"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
<span class="token comment">#pattern : 'en' + 'taille' + lettres en maj</span>

matcher<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"tailles"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>pattern<span class="token punctuation">]</span><span class="token punctuation">)</span>
matches <span class="token operator">=</span> matcher<span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token keyword">for</span> _<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end <span class="token keyword">in</span> matches<span class="token punctuation">:</span>
    span <span class="token operator">=</span> doc<span class="token punctuation">[</span>start<span class="token punctuation">:</span>end<span class="token punctuation">]</span>  <span class="token comment"># The matched span</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>span<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">&#123;</span>start<span class="token punctuation">&#125;</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">&#123;</span>end<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span></code><!-- HTML_TAG_END --></pre> <blockquote data-svelte-h="svelte-1gl5z27"><p>en taille XL (5, 8)</p></blockquote> <p data-svelte-h="svelte-7o74nv">Ã‡a fonctionne pour les sÃ©quences comme Â« en taille M Â» ou Â« en taille XL Â» mais pas pour Â« vous lâ€™avez en XL ? Â»</p> <p data-svelte-h="svelte-g325eo">Câ€™est un patron de repÃ©rage de sÃ©quences de mots. Il est possible de rechercher aussi des regEx.</p> <p data-svelte-h="svelte-1bgnoir">Pour les entitÃ©s nommÃ©es, parfois Ã§a fonctionne mal avec le franÃ§ais (prÃ©noms mal Ã©tiquetÃ©, comme misc par exemple), il est donc possible de travailler avec des patrons pour correctement Ã©tiqueter les entitÃ©s nommÃ©es, Ã  partir dâ€™un liste de noms par exemple.</p> <p data-svelte-h="svelte-zz27la">Depuis la v3 de spaCy, il y a un nouvel outil, Dependency Matcher qui permet de faire de lâ€™extraction de patrons syntaxiques. On peut faire porter les requÃªtes sur lâ€™arbre syntaxique et non plus seulement sur la sÃ©quence des tokens.
Permet aussi de tirer des informations sur un texte, Ã  partir de pattern prÃ©cis
Par exemple rÃ©cupÃ©rer tous tokens qui sont les lemmes de Â« acheter Â» ou Â«Â vendre Â», puis dâ€™analyser les dÃ©pendances de ces tokens pour extraite, par exemple, le sujet et lâ€™objet.</p> <p data-svelte-h="svelte-175sjvu">Une critique, câ€™est que spaCy ne prend pas le format sql (pris en charge par txm par exemple).</p> <h2 data-svelte-h="svelte-1w26jsl">Adaptation du modÃ¨le</h2> <h3 data-svelte-h="svelte-1sob5kz">Lâ€™exemple des entitÃ©s nommÃ©es</h3> <p data-svelte-h="svelte-j69u7p">La taille et la nature du corpus dâ€™entraÃ®nement seront dÃ©terminantes. Il est possible dâ€™amender un modÃ¨le existant avec un jeu de donnÃ©es annotÃ©es de taille rÃ©duite.
Exemple sur les entitÃ©s nommÃ©es mais la procÃ¨dure dâ€™entraÃ®nement fonctionne pour dâ€™autres niveaux dâ€™annotations (pos, dÃ©pendance)
Voir la <a href="https://spacy.io/usage/training" rel="nofollow">doc</a>.</p> <p data-svelte-h="svelte-plu7oa">SpaCy propose aussi des outils pour Ã©valuer les performance des modÃ¨les que lâ€™on a gÃ©nÃ©rÃ©, ainsi que des mÃ©canismes dâ€™export et dâ€™import des modÃ¨les et des donnÃ©es.</p> <p data-svelte-h="svelte-1rz72dk">Il ne faut pas avoir peur de faire son propre modÃ¨le, pour le traitement dâ€™un corpus spÃ©cifique, ce nâ€™est pas forcÃ©ment trÃ¨s long Ã  faire.</p></article></main>   <footer class="svelte-1capoi1" data-svelte-h="svelte-1h3xx8c"><nav><ul class="svelte-1capoi1"><li><a href="https://github.com/sardinecan/log" class="svelte-1capoi1">Github</a></li> </ul></nav></footer> </div> 
			
			<script>
				{
					__sveltekit_fy0s1o = {
						base: new URL("../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../_app/immutable/entry/start.B9fD-3Wj.js"),
						import("../../_app/immutable/entry/app.DF3f1qoj.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 7],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
